<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate nonparametric smooth trends — smoothTrend â€¢ openair</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">openair</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/davidcarslaw/openair">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate nonparametric smooth trends</h1>
    </div>

    
    <p>Use non-parametric methods to calculate time series trends</p>
    

    <pre><span class='fu'>smoothTrend</span>(<span class='no'>mydata</span>, <span class='kw'>pollutant</span> <span class='kw'>=</span> <span class='st'>"nox"</span>, <span class='kw'>deseason</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>type</span> <span class='kw'>=</span> <span class='st'>"default"</span>,
  <span class='kw'>statistic</span> <span class='kw'>=</span> <span class='st'>"mean"</span>, <span class='kw'>avg.time</span> <span class='kw'>=</span> <span class='st'>"month"</span>, <span class='kw'>percentile</span> <span class='kw'>=</span> <span class='fl'>NA</span>,
  <span class='kw'>data.thresh</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>simulate</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>n</span> <span class='kw'>=</span> <span class='fl'>200</span>, <span class='kw'>autocor</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>cols</span> <span class='kw'>=</span> <span class='st'>"brewer1"</span>, <span class='kw'>shade</span> <span class='kw'>=</span> <span class='st'>"grey95"</span>, <span class='kw'>xlab</span> <span class='kw'>=</span> <span class='st'>"year"</span>,
  <span class='kw'>y.relation</span> <span class='kw'>=</span> <span class='st'>"same"</span>, <span class='kw'>ref.x</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>ref.y</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>key.columns</span> <span class='kw'>=</span> <span class='fu'>length</span>(<span class='no'>percentile</span>), <span class='kw'>name.pol</span> <span class='kw'>=</span> <span class='no'>pollutant</span>, <span class='kw'>ci</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fl'>0.2</span>, <span class='kw'>date.breaks</span> <span class='kw'>=</span> <span class='fl'>7</span>, <span class='kw'>auto.text</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>k</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <dl class="dl-horizontal">
      <dt>mydata</dt>
      <dd>A data frame containing the field <code>date</code> and at
least one other parameter for which a trend test is required;
typically (but not necessarily) a pollutant.</dd>
      <dt>pollutant</dt>
      <dd>The parameter for which a trend test is required.
Mandatory.</dd>
      <dt>deseason</dt>
      <dd>Should the data be de-deasonalized first? If
<code>TRUE</code> the function <code>stl</code> is used (seasonal trend
decomposition using loess). Note that if <code>TRUE</code> missing
data are first linearly interpolated because <code>stl</code> cannot
handle missing data.</dd>
      <dt>type</dt>
      <dd><code>type</code> determines how the data are split i.e.
conditioned, and then plotted. The default is will produce a 
single plot using the entire data. Type can be one of the
built-in types as detailed in <code>cutData</code> e.g.
&#8220;season&#8221;, &#8220;year&#8221;, &#8220;weekday&#8221; and so on. For
example, <code>type = &quot;season&quot;</code> will produce four plots --- one
for each season.

It is also possible to choose <code>type</code> as another variable in
the data frame. If that variable is numeric, then the data will
be split into four quantiles (if possible) and labelled 
accordingly. If type is an existing character or factor
variable, then those categories/levels will be used directly.
This offers great flexibility for understanding the variation of
different variables and how they depend on one another.

Type can be up length two e.g. <code>type = c(&quot;season&quot;,
&quot;weekday&quot;)</code> will produce a 2x2 plot split by season and day of
the week. Note, when two types are provided the first forms the
columns and the second the rows.</dd>
      <dt>statistic</dt>
      <dd>Statistic used for calculating monthly values.
Default is &#8220;mean&#8221;, but can also be &#8220;percentile&#8221;.
See <code>timeAverage</code> for more details.</dd>
      <dt>avg.time</dt>
      <dd>Can be &#8220;month&#8221; (the default),
&#8220;season&#8221; or &#8220;year&#8221;. Determines the time over which
data should be averaged. Note that for &#8220;year&#8221;, six or
more years are required. For &#8220;season&#8221; the data are plit
up into spring: March, April, May etc. Note that December is
considered as belonging to winter of the following year.</dd>
      <dt>percentile</dt>
      <dd>Percentile value(s) to use if <code>statistic = 
&quot;percentile&quot;</code> is chosen. Can be a vector of numbers e.g.
<code>percentile = c(5, 50, 95)</code> will plot the 5th, 50th and
95th percentile values together on the same plot.</dd>
      <dt>data.thresh</dt>
      <dd>The data capture threshold to use (<!-- %) when -->
aggregating the data using <code>avg.time</code>. A value of zero
means that all available data will be used in a particular
period regardless if of the number of values available.
Conversely, a value of 100 will mean that all data will need to
be present for the average to be calculated, else it is recorded
as <code>NA</code>. Not used if <code>avg.time = &quot;default&quot;</code>.</dd>
      <dt>simulate</dt>
      <dd>Should simulations be carried out to determine the
Mann-Kendall tau and p-value. The default is <code>FALSE</code>. If 
<code>TRUE</code>, bootstrap simulations are undertaken, which also
account for autocorrelation.</dd>
      <dt>n</dt>
      <dd>Number of bootstrap simulations if <code>simulate =
TRUE</code>.</dd>
      <dt>autocor</dt>
      <dd>Should autocorrelation be considered in the trend 
uncertainty estimates? The default is <code>FALSE</code>. Generally,
accounting for autocorrelation increases the uncertainty of the
trend estimate sometimes by a large amount.</dd>
      <dt>cols</dt>
      <dd>Colours to use. Can be a vector of colours e.g.
<code>cols = c(&quot;black&quot;, &quot;green&quot;)</code> or pre-defined openair colours
--- see <code>openColours</code> for more details.</dd>
      <dt>shade</dt>
      <dd>The colour used for marking alternate years. Use 
&#8220;white&#8221; or &#8220;transparent&#8221; to remove shading.</dd>
      <dt>xlab</dt>
      <dd>x-axis label, by default &#8220;year&#8221;.</dd>
      <dt>y.relation</dt>
      <dd>This determines how the y-axis scale is plotted.
&quot;same&quot; ensures all panels use the same scale and &quot;free&quot; will use
panel-specfic scales. The latter is a useful setting when 
plotting data with very different values.  ref.x See
<code>ref.y</code> for details. In this case the correct date format
should be used for a vertical line e.g.  <code>ref.x = list(v = 
as.POSIXct(&quot;2000-06-15&quot;), lty = 5)</code>.</dd>
      <dt>ref.x</dt>
      <dd>See <code>ref.y</code>.</dd>
      <dt>ref.y</dt>
      <dd>A list with details of the horizontal lines to be 
added representing reference line(s). For example, <code>ref.y =
list(h = 50, lty = 5)</code> will add a dashed horizontal line at 50.
Several lines can be plotted e.g. <code>ref.y = list(h = c(50, 
100), lty = c(1, 5), col = c(&quot;green&quot;, &quot;blue&quot;))</code>. See 
<code>panel.abline</code> in the <code>lattice</code> package for more
details on adding/controlling lines.</dd>
      <dt>key.columns</dt>
      <dd>Number of columns used if a key is drawn when
using the option <code>statistic = &quot;percentile&quot;</code>.</dd>
      <dt>name.pol</dt>
      <dd>Names to be given to the pollutant(s). This is 
useful if you want to give a fuller description of the
variables, maybe also including subscripts etc.</dd>
      <dt>ci</dt>
      <dd>Should confidence intervals be plotted? The default is 
<code>FALSE</code>.</dd>
      <dt>alpha</dt>
      <dd>The alpha transparency of shaded confidence intervals
- if plotted. A value of 0 is fully transparent and 1 is fully
opaque.</dd>
      <dt>date.breaks</dt>
      <dd>Number of major x-axis intervals to use. The
function will try and choose a sensible number of dates/times as
well as formatting the date/time appropriately to the range
being considered. This does not always work as desired
automatically. The user can therefore increase or decrease the
number of intervals by adjusting the value of <code>date.breaks</code>
up or down.</dd>
      <dt>auto.text</dt>
      <dd>Either <code>TRUE</code> (default) or <code>FALSE</code>. If 
<code>TRUE</code> titles and axis labels will automatically try and
format pollutant names and units properly e.g.  by subscripting
the &#8216;2&#8217; in NO2.</dd>
      <dt>k</dt>
      <dd>This is the smoothing parameter used by the <code>gam</code> 
function in package <code>mgcv</code>. By default it is not used and
the amount of smoothing is optimised automatically. However,
sometimes it is useful to set the smoothing amount manually
using <code>k</code>.</dd>
      <dt>...</dt>
      <dd>Other graphical parameters are passed onto
<code>cutData</code> and <code>lattice:xyplot</code>. For example,
<code>smoothTrend</code> passes the option <code>hemisphere =
&quot;southern&quot;</code> on to <code>cutData</code> to provide southern (rather
than default northern) hemisphere handling of <code>type =
&quot;season&quot;</code>. Similarly, common graphical arguments, such as
<code>xlim</code> and <code>ylim</code> for plotting ranges and <code>pch</code>
and <code>cex</code> for plot symbol type and size, are passed on
<code>xyplot</code>, although some local modifications may be applied
by openair. For example, axis and title labelling options (such 
as <code>xlab</code>, <code>ylab</code> and <code>main</code>) are passed to
<code>xyplot</code> via <code>quickText</code> to handle routine formatting.
One special case here is that many graphical parameters can be
vectors when used with <code>statistic = &quot;percentile&quot;</code> and a
vector of <code>percentile</code> values, see examples below.</dd>
    </dl>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>As well as generating the plot itself, <code>smoothTrend</code> 
  also returns an object of class ``openair&#39;&#39;. The object includes
  three main components: <code>call</code>, the command used to generate
  the plot; <code>data</code>, the data frame of summarised information 
  used to make the plot; and <code>plot</code>, the plot itself. Note
  that <code>data</code> is a list of two data frames: <code>data</code> (the 
  original data) and <code>fit</code> (the smooth fit that has details
  of the fit and teh uncertainties). If retained, e.g. using 
  <code>output &lt;- smoothTrend(mydata, &quot;nox&quot;)</code>, this output can be 
  used to recover the data, reproduce or rework the original plot
  or undertake further analysis.</p>
    <p>An openair output can be manipulated using a number of generic
  operations, including <code>print</code>, <code>plot</code> and
  <code>summarise</code>.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The <code>smoothTrend</code> function provides a flexible way of
estimating the trend in the concentration of a pollutant or other
variable. Monthly mean values are calculated from an hourly (or
higher resolution) or daily time series. There is the option to
deseasonalise the data if there is evidence of a seasonal cycle.</p>
    <p><code>smoothTrend</code> uses a Generalized Additive Model (GAM) from
the <code>gam</code> package to find the most appropriate level
of smoothing.  The function is particularly suited to situations
where trends are not monotonic (see discussion with
<code><a href='TheilSen.html'>TheilSen</a></code> for more details on this). The
<code>smoothTrend</code> function is particularly useful as an
exploratory technique e.g. to check how linear or non-linear
trends are.</p>
    <p>95<!-- % confidence intervals are shown by shading. Bootstrap estimates -->
of the confidence intervals are also available through the
<code>simulate</code> option.  Residual resampling is used.</p>
    <p>Trends can be considered in a very wide range of ways, controlled by
setting <code>type</code> - see examples below.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='TheilSen.html'>TheilSen</a></code> for an alternative method of
  calculating trends.</p>
    

    <h2 class="hasAnchor" id="examples">
      <a class="anchor" href="#examples"></a>
      Examples
    </h2>
    <pre class="examples"><div class='input'>
<span class='co'># load example data from package</span>
<span class='fu'>data</span>(<span class='no'>mydata</span>)

<span class='co'># trend plot for nox</span>
<span class='fu'>smoothTrend</span>(<span class='no'>mydata</span>, <span class='kw'>pollutant</span> <span class='kw'>=</span> <span class='st'>"nox"</span>)</div><img src='smoothTrend-2.png' alt='' width='540' height='400' /><div class='input'>
<span class='co'># trend plot by each of 8 wind sectors</span>
<span class='co'>## Not run: smoothTrend(mydata, pollutant = &amp;quot;o3&amp;quot;, type = &amp;quot;wd&amp;quot;, ylab = &amp;quot;o3 (ppb)&amp;quot;)</span>

<span class='co'># several pollutants, no plotting symbol</span>
<span class='co'>## Not run: smoothTrend(mydata, pollutant = c(&amp;quot;no2&amp;quot;, &amp;quot;o3&amp;quot;, &amp;quot;pm10&amp;quot;, &amp;quot;pm25&amp;quot;), pch = NA)</span>

<span class='co'># percentiles</span>
<span class='co'>## Not run: ------------------------------------</span>
<span class='co'># smoothTrend(mydata, pollutant = "o3", statistic = "percentile",</span>
<span class='co'># percentile = 95)</span>
<span class='co'>## ---------------------------------------------</span>

<span class='co'># several percentiles with control over lines used</span>
<span class='co'>## Not run: ------------------------------------</span>
<span class='co'># smoothTrend(mydata, pollutant = "o3", statistic = "percentile",</span>
<span class='co'># percentile = c(5, 50, 95), lwd = c(1, 2, 1), lty = c(5, 1, 5))</span>
<span class='co'>## ---------------------------------------------</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
David Carslaw

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by David Carslaw, Karl Ropkins.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
