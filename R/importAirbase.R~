##' Import EEA airbase hourly air quality data
##'
##' The European Environment Agency (EEA) makes available hourly air pollution data from across Europe (see \url{http://acm.eionet.europa.eu/databases/airbase/}). The EEA go to great lengths to compile, check and make available a huge amount of air quality data.
##' @title Function to import hourly data from the European Environment Agency airbase database
##' @param site Site code(s) of the sites to be imported. Can be upper or lower case.
##' @param local Used for tesing local imports.
##' @return 
##' @author David Carslaw
importAirbase <- function(site = "gb0682a", local = NA) {

    ## get rid of R check annoyances
    dat <- NULL

    site <- toupper(site)

    files <- site

    loadData <- function(x) {
        tryCatch({

            if (is.na(local)) {
                fileName <- paste("http://www.erg.kcl.ac.uk/downloads/Policy_Reports/airbase/", x, ".RData", sep = "")

                con <- url(fileName)
                load(con)
                close(con)

            } else { ## load from local file system

                con <- paste(local, x, ".RData", sep = "")
                load(con)
            }

            dat
        },
                 error = function(ex) {cat(x, "does not exist - ignoring that one.\n")})
    }
    
    thedata <- lapply(files, loadData)
    thedata <- thedata[!sapply(thedata, is.null)] ## remove NULL
    thedata <- do.call(rbind.fill, thedata)

    thedata
}
